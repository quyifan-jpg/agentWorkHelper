syntax = "v1"

info (
    title: "业务后台"   // 项目标题
    author: "鹏哥"
)

type (
    // 待办事项的操作记录，Content表示操作内容，比如上传一张图片
    TodoRecord  {
        TodoId   string  `json:"todoId,omitempty"`
        UserId   string  `json:"userId,omitempty"`
        UserName string  `json:"userName,omitempty"`
        Content  string  `json:"content,omitempty"`
        Image    string  `json:"image,omitempty"`
        CreateAt int64   `json:"createAt,omitempty"`
    }

    Todo  {
        ID         string        `json:"id,omitempty"`
        CreatorId  string        `json:"creatorId,omitempty"`
        CreatorName string       `json:"creatorName,omitempty"`
        Title      string        `json:"title,omitempty"`
        DeadlineAt int64         `json:"deadlineAt,omitempty"`
        Desc       string        `json:"desc,omitempty"`
        Status     int           `json:"status,omitempty"`
        Records    []*TodoRecord `json:"records,omitempty"`
        ExecuteIds []string      `json:"executeIds,omitempty"`   // 待办执行人
        TodoStatus int           `json:"todoStatus,omitempty"`
    }

    // 用户和待办事项的管理关系，
    UserTodo {
        ID         string `json:"id,omitempty"`
        UserId     string `json:"userId,omitempty"`
        UserName   string `json:"userName,omitempty"`
        TodoId     string `json:"todoId,omitempty"`
        TodoStatus int    `json:"todoStatus,omitempty"`   // 待办事项的状态
    }

    TodoInfoResp  {
        ID         string        `json:"id,omitempty"`
        CreatorId  string        `json:"creatorId,omitempty"`
        CreatorName string       `json:"creatorName,omitempty"`
        Title      string        `json:"title,omitempty"`
        DeadlineAt int64         `json:"deadlineAt,omitempty"`
        Desc       string        `json:"desc,omitempty"`
        Records    []*TodoRecord `json:"records,omitempty"`
        ExecuteIds []*UserTodo   `json:"executeIds,omitempty"`
        Status     int           `json:"status,omitempty"`
        TodoStatus int           `json:"todoStatus,omitempty"`
    }

    FinishedTodoReq {
        UserId string `json:"userId"`
        TodoId string `json:"todoId"`
    }

    todoListReq {
        Id          string `json:"id,omitempty"`
        UserId      string `json:"userId,omitempty"`
        Page        int    `json:"page,omitempty"`
        Count       int    `json:"count,omitempty"`
        StartTime  int64 `json:"startTime,omitempty"`
        EndTime     int64 `json:"endTime,omitempty"`
    }

    todoListResp {
        Count int64  `json:"count"`
        List []*Todo `json:"data"`
    }
)

@server(
    group: v1/todo
    logic: Todo
    middleware: Jwt
)
service todo {
    @server(
        handler: Info
        logic: Todo.Info
    )
    get /:id(IdPathReq) returns (TodoInfoResp)

    @server(
        handler: Create
        logic: Todo.Create
    )
    post / (Todo) returns (IdResp)

    @server(
        handler: Edit
        logic: Todo.Edit
    )
    put / (Todo)

    @server(
        handler: Delete
        logic: Todo.Delete
    )
    delete /:id(IdPathReq)

    @server(
        handler: Finish
        logic: Todo.Finish
        doc: 完成待办
    )
    post /finish(FinishedTodoReq)

    @server(
        handler: CreateRecord
        logic: Todo.CreateRecord
        doc: 用户操作记录
    )
    post /record (TodoRecord)

    @server(
        handler: List
        logic: Todo.List
        doc: 待办列表
    )
    get /list (todoListReq) returns(todoListResp)
}