// 用户模块接口定义
syntax = "v1"

import "base.api"

info (
	title:  "AIWorkHelper Backend API"
	author: "BackEnd"
)

type (
	// 用户基础信息
	User {
		Id       uint   `json:"id,omitempty"` // 用户ID
		Name     string `json:"name,omitempty"` // 用户名
		Password string `json:"password,omitempty"` // 密码
		Status   int    `json:"status,omitempty"` // 状态：0=正常 1=禁用
		IsAdmin  bool   `json:"isAdmin,omitempty"` // 是否管理员
		Gender   string `json:"gender,omitempty"` // 测试todo
	}
	// 注册请求
	RegisterReq {
		Name     string `json:"name" binding:"required"` // 用户名
		Password string `json:"password" binding:"required"` // 密码
	}
	// 注册响应
	RegisterResp {
		Message string `json:"message,omitempty"` // 响应消息
	}
	// 登录请求
	LoginReq {
		Name     string `json:"name" binding:"required"` // 用户名
		Password string `json:"password" binding:"required"` // 密码
	}
	// 登录响应
	LoginResp {
		Status       int    `json:"status,omitempty"` // 状态：1=成功
		Id           uint   `json:"id,omitempty"` // 用户ID
		Name         string `json:"name,omitempty"` // 用户名
		Token        string `json:"token,omitempty"` // JWT令牌
		AccessExpire int64  `json:"accessExpire,omitempty"` // 过期时间
		RefreshAfter int64  `json:"refreshAfter,omitempty"` // 刷新时间
	}
	// 用户信息响应
	UserInfoResp {
		Id      uint   `json:"id,omitempty"`
		Name    string `json:"name,omitempty"` // 用户名
		Status  int    `json:"status,omitempty"`
		IsAdmin bool   `json:"isAdmin,omitempty"`
	}
	// 更新用户资料请求
	UpdateProfileReq {
		Name string `json:"name,omitempty"` // 用户名
	}
	// 修改密码请求
	UpdatePasswordReq {
		OldPwd string `json:"oldPwd" binding:"required"` // 旧密码
		NewPwd string `json:"newPwd" binding:"required,min=6"` // 新密码（最少6位）
	}
	// 用户列表查询请求
	UserListReq {
		Ids   []string `json:"ids,omitempty"` // 用户ID列表
		Name  string   `json:"name,omitempty"` // 用户名模糊搜索
		Page  int      `json:"page,omitempty"` // 页码
		Count int      `json:"count,omitempty"` // 每页数量
	}
	// 用户列表响应
	UserListResp {
		Count int64  `json:"count"` // 总记录数
		Data  []User `json:"data"` // 用户列表
	}
)

// 用户服务 - 公开接口
@server (
	group: v1/user
	logic: User
)
service User {
	@handler Register
	post /register (RegisterReq) returns (RegisterResp)

	@handler Login
	post /login (LoginReq) returns (LoginResp)
}

// 用户服务 - 需要认证
@server (
	group:      v1/user
	logic:      User
	middleware: Jwt
)
service User {
	@handler Info
	get /info returns (UserInfoResp)

	@handler UpdateProfile
	put /profile (UpdateProfileReq)

	@handler UpdatePassword
	post /password (UpdatePasswordReq)

	@handler GetUserByID
	get /:id (IdPathReq) returns (UserInfoResp)

	@handler CreateUser
	post / (User)

	@handler UpdateUser
	put / (User)

	@handler DeleteUser
	delete /:id (IdPathReq)

	@handler ListUsers
	get /list (UserListReq) returns (UserListResp)
}

